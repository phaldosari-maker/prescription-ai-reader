import streamlit as st
import google.generativeai as genai
from PIL import Image

# --- ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ ---
st.set_page_config(page_title="ูุญูู ุงููุตูุงุช (Gemini 2.0)", layout="centered")

st.title("๐ฉบ ูุงุฑุฆ ุงููุตูุงุช ุงูุทุจูุฉ ุงูุฐูู")
st.caption("ูุนูู ุจูุงุณุทุฉ Google Gemini 2.0 Flash")

# --- ุฅุฏุฎุงู ุงูููุชุงุญ ---
api_key = st.text_input("ุฃุฏุฎู ููุชุงุญ Google API Key:", type="password")

# --- ุฏุงูุฉ ุงูุชุญููู ---
def analyze_prescription(api_key, image):
    try:
        genai.configure(api_key=api_key)
        
        # --- ููุง ุงูุชุนุฏูู: ุงุณุชุฎุฏููุง ุงูููุฏูู ุงูููุฌูุฏ ูู ูุงุฆูุชู ---
        model_name = 'gemini-2.0-flash'
        
        model = genai.GenerativeModel(model_name)
        
        prompt = """
        ุฃูุช ุตูุฏูู ุฎุจูุฑ ููุณุงุนุฏ ุทุจู ุฐูู.
        ูู ุจุชุญููู ุตูุฑุฉ ุงููุตูุฉ ุงูุทุจูุฉ ุงููุฑููุฉ ุจุฏูุฉ ุนุงููุฉ ุฌุฏุงู.
        
        ุงููุทููุจ ููู:
        1. ุงุณุชุฎุฑุงุฌ ุฃุณูุงุก ุงูุฃุฏููุฉ ุงูููุชูุจุฉ ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ.
        2. ุงุณุชุฎุฑุงุฌ ุงูุฌุฑุนุงุช (ูู ูุฑุฉ ูู ุงูููู).
        3. ุชุฑุฌูุฉ ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู ุฅูู ุงููุบุฉ ุงูุนุฑุจูุฉ (ูุซูุงู: ุญุจุฉ ุจุนุฏ ุงูุฃูู).
        
        ููุงุญุธุฉ: ุฅุฐุง ูุงู ุงูุฎุท ุบูุฑ ูุงุถุญุ ุงุณุชุฎุฏู ุฎุจุฑุชู ุงูุทุจูุฉ ูุชููุน ุงุณู ุงูุฏูุงุก ุงูุตุญูุญ ุจูุงุกู ุนูู ุงูุฃุญุฑู ุงูุธุงูุฑุฉ.
        
        ุงุนุฑุถ ุงููุชูุฌุฉ ูู ุฌุฏูู ููุธู.
        """
        
        # ุฅุฑุณุงู ุงูุตูุฑุฉ ูุงูุทูุจ
        response = model.generate_content([prompt, image])
        return response.text

    except Exception as e:
        return f"ุญุฏุซ ุฎุทุฃ: {e}"

# --- ูุงุฌูุฉ ุงูุฑูุน ---
uploaded_file = st.file_uploader("ุงุฑูุน ุตูุฑุฉ ุงููุตูุฉ ููุง", type=["jpg", "png", "jpeg"])

if uploaded_file is not None:
    # ุนุฑุถ ุงูุตูุฑุฉ
    image = Image.open(uploaded_file)
    st.image(image, caption='ุงููุตูุฉ ุงููุฑููุฉ', use_column_width=True)
    
    if st.button("๐ ุชุญููู ุงููุตูุฉ ุงูุขู"):
        if not api_key:
            st.error("ุงูุฑุฌุงุก ุฅุฏุฎุงู ููุชุงุญ API ุฃููุงู.")
        else:
            with st.spinner('ุฌุงุฑู ูุฑุงุกุฉ ุงููุตูุฉ ุจุงุณุชุฎุฏุงู Gemini 2.0...'):
                result = analyze_prescription(api_key, image)
                
                # ุงูุชุญูู ูู ูุฌูุฏ ุฎุทุฃ
                if "ุญุฏุซ ุฎุทุฃ" in result:
                    st.error(result)
                else:
                    st.success("ุชู ุงูุชุญููู ุจูุฌุงุญ!")
                    st.markdown("### ๐ ุงููุชูุฌุฉ ุงูุทุจูุฉ:")
                    st.markdown(result)
                    st.warning("โ๏ธ ุชูุจูู ูุงู: ูุฐุง ูุธุงู ุฐูุงุก ุงุตุทูุงุนู ูุณุงุนุฏ. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุตูุฏูู ุงูุฏูุณุฑู ูุจู ุตุฑู ุงูุฏูุงุก.")
